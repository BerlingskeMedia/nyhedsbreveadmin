<h2>Uploader</h2>

<p class="help-block">Generelle handler for alle rækker</p>

<form class="form-inline" style="padding: 6px 0px;" ng-repeat="action in actions track by $index">
  <p>Handling {{$index+1}}</p>
  <div class="form-group form-group-sm">

    <select class="form-control" ng-model="action.operation">
      <option value="signup">Tilmeld</option>
      <option value="signout">Afmeld</option>
      <option value="campaign">Kampagne</option>
    </select>

    <input type="text" class="form-control" ng-model="action.id" placeholder="Navn" ng-if="action.operation === 'campaign'">

    <span ng-if="action.operation === 'signup' || action.operation === 'signout'">

      <select class="form-control" ng-model="action.type">
        <option value="nyhedsbrev">Nyhedsbrev</option>
        <option value="permission">Permission</option>
        <option value="interesse">Interesse</option>
        <option value="optout">Optout</option>
      </select>

      <select class="form-control" ng-model="action.id" ng-if="action.type === 'nyhedsbrev'">
        <option disabled selected="selected" value="">Vælg</option>
        <option ng-repeat="nyhedsbrev in nyhedsbreve" value="{{nyhedsbrev.nyhedsbrev_id}}">{{nyhedsbrev.nyhedsbrev_navn}}</option>
      </select>

      <select class="form-control" ng-model="action.id" ng-if="action.type === 'permission'">
        <option disabled selected="selected" value="">Vælg</option>
        <option ng-repeat="permission in permissions" value="{{permission.nyhedsbrev_id}}">{{permission.nyhedsbrev_navn}}</option>
      </select>

      <select class="form-control" ng-model="action.id" ng-if="action.type === 'interesse'">
        <option disabled selected="selected" value="">Vælg</option>
        <option ng-repeat="interesse in interesser" value="{{interesse.interesse_id}}">{{interesse.interesse_navn}}</option>
      </select>

      <select class="form-control" ng-model="action.id" ng-if="action.type === 'optout'">
        <option disabled selected="selected" value="">Vælg</option>
        <option ng-repeat="optout in optouts" value="{{optout.type_id}}">{{optout.type_desc}}</option>
      </select>
    </span>

  </div>
  <div class="form-group">
  </div>
</form>

<form class="form">
  <div class="form-group form-group-sm">
    <button ng-class="" class="btn btn-primary" ng-click="addAction()">Tilføj handling</button>
  </div>
</form>

<!-- <form class="form">
  <div class="form-group">
    <select class="form-control" ng-model="location_id">
      <option disabled selected="selected" value="">Vælg</option>
      <option ng-repeat="location in locations" value="{{location.location_id}}">{{location.location_tekst}}</option>
    </select>
  </div>
</form> -->

<hr />

<form class="form-inline">
  <p class="help-block">Indlæs en CSV fil og se indhold. (<small><span ng-bind-html="::getCsvSampleFile()"></span></small>)</p>
  <div class="form-group">
    <input type="file" id="importFile" name="importFile" />
  </div>
  <!-- <div class="checkbox">
    <label>
      <input type="checkbox"ng-model="fileHasHeader"> Første linie er header
    </label>
  </div> -->
  <button ng-class="" class="btn btn-default btn-sm" ng-click="parseFileContent()">Se indhold</button>
</form>

<div class="row">
  <div class="col-sm-12">
    Rækker: {{ totalUsersCount }} / Valideret: {{ validatedUsersIndex }} / Fundet: {{ totalUsersFound }} / Oprettes: {{ totalUsersToInsert }}
  </div>
</div>

<br />

<table class="table table-bordered">
  <thead ng-if="headers.length > 0">
    <tr>
      <th ng-repeat="header in headers">{{::header}}</th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="row in rows track by $index" ng-class="{'info': row.found, 'success': row.inserted, 'warning': row.notfound, 'danger': row.manyfound}">
      <td ng-repeat="field in flattenRowData(row.data) track by $index">
        {{::field}}
      </td>
    </tr>
  </tbody>
</table>

<div class="row">
  <div class="col-sm-12">
  </div>
</div>
